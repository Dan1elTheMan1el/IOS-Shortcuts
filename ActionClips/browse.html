<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Select Action Clip to download!</title>

    <style>
        :root {
            --bg: #0a0a0c;
            --card: #111;
            --text: #e8ebee;
            --muted: #9ba0a8;
            --accent: #0fa5a4;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text";
            padding: 14px;
        }

        header {
            display: flex;
            gap: 8px;
        }

        input[type=url],
        input[type=search] {
            flex: 1;
            padding: 11px;
            border-radius: 12px;
            border: 1px solid #222;
            background: #0f0f12;
            color: var(--text);
            font-size: 16px;
        }

        button {
            padding: 11px 16px;
            border-radius: 12px;
            border: none;
            background: var(--accent);
            color: #031314;
            font-weight: 600;
        }

        #searchRow {
            display: none;
            margin-top: 15px;
        }

        #clips {
            display: grid;
            gap: 12px;
            margin-top: 15px;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        }

        .card {
            background: #111;
            border-radius: 14px;
            padding: 12px;
            display: flex;
            gap: 12px;
            align-items: center;
            border: 1px solid #1a1a1d;
        }

        .icon img {
            width: 40px;
            height: 40px;
            border-radius: 14px;
            object-fit: cover;
        }

        .author {
            margin-top: 6px;
            font-size: 12px;
            color: var(--muted);
        }

        .name {
            font-weight: 700;
            font-size: 15px;
        }

        .sub {
            color: var(--muted);
            font-size: 13px;
            margin-top: 3px;
        }

        .actions button {
            margin-top: 6px;
            padding: 6px 10px;
            border-radius: 10px;
            background: transparent;
            border: 1px solid #197f7d;
            color: var(--accent);
            font-size: 13px;
        }

        .screenshot-btn {
            margin-left: 8px;
            padding: 6px 8px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid #197f7d;
            color: var(--accent);
            font-size: 13px;
            cursor: pointer;
        }

        /* Overlay for screenshot */
        #screenshotOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        #screenshotOverlay img {
            max-width: 95vw;
            max-height: 95vh;
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
        }

        #screenshotClose {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 1px solid #444;
            color: var(--text);
            font-size: 20px;
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div id="searchRow">
        <input id="search" type="search" placeholder="Search clips‚Ä¶">
    </div>


    <div id="clips"></div>

    <div id="screenshotOverlay" tabindex="-1" role="dialog" aria-modal="true">
        <button id="screenshotClose" aria-label="Close">‚úï</button>
        <img id="screenshotImg" alt="Screenshot">
    </div>

    <script>
        // === DOM refs ===
        const clipsDiv = document.getElementById("clips");
        const status = document.getElementById("status");
        const searchRow = document.getElementById("searchRow");
        const searchInput = document.getElementById("search");
        searchRow.style.display = "block";

        // Load posts JSON
        let clips = [
            ...(() => {
                try {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', 'https://raw.githubusercontent.com/Dan1elTheMan1el/IOS-Shortcuts/refs/heads/main/ActionClips/clips/posted.json', false);
                    xhr.send(null);
                    if (xhr.status >= 200 && xhr.status < 300) {
                        const json = JSON.parse(xhr.responseText).posts;
                        console.log(json);
                        if (Array.isArray(json)) return json;
                    }
                } catch (e) { /* ignore */ }
                return [];
            })()
        ];

        // === Copy without showing keyboard ===
        function safeCopy(text) {
            const t = document.createElement("textarea");
            t.value = text;
            t.style.position = "fixed";
            t.style.opacity = "0";
            t.style.pointerEvents = "none";
            document.body.appendChild(t);

            t.select();
            t.setSelectionRange(0, 999999);

            document.execCommand("copy");
            document.body.removeChild(t);
        }

        // === Render ===
        function renderClips(list) {
            clipsDiv.innerHTML = list.map(clip => `
    <div class="card">
      <div class="icon" style="flex-shrink:0; text-align:center;">
        <img src="${'data:image/png;base64,' + clip.icon64}" alt="${clip.name} Icon">
        <div class="author">${clip.author.length < 16 ? clip.author : clip.author.slice(0, 13) + "..."}</div>
      </div>
      <div style="flex:1">
        <div style="display:flex; align-items:center; gap:8px;">
          <div class="name" style="flex:1">${clip.name}</div>
          ${(clip.screenshot64) ? `<button class="screenshot-btn" onclick='openScreenshot("data:image/png;base64,${(clip.screenshot64)}")' aria-label="View screenshot">üîç</button>` : ''}
        </div>
        <div class="sub">${clip.description} ‚Ä¢ <b>${clip.actionCount}</b> Actions ‚Ä¢ ${clip.date}</div>
        <div class="actions">
          <button onclick='selectClip(${JSON.stringify(clip).replace(/'/g, "&#39;")}, this)'>
            Select
          </button>
        </div>
      </div>
    </div>
  `).join("");
        }

        // === Select Clip ===
        function selectClip(clip, btn) {
            const dict = {
                name: clip.name,
                fileName: clip.fileName
            };
            safeCopy(encodeURIComponent(JSON.stringify(dict)));

            // Update button text
            btn.textContent = "Selected!";
            // Update page title
            document.title = "Press to continue ‚Üí";
        }

        // === Search ===
        searchInput.addEventListener("input", () => {
            const q = searchInput.value.toLowerCase();
            const filtered = clips.filter(c =>
                c.name.toLowerCase().includes(q) ||
                c.description.toLowerCase().includes(q) ||
                c.author.toLowerCase().includes(q)
            );
            renderClips(filtered);
        });

        // === Screenshot overlay handlers ===
        function openScreenshot(src) {
            if (!src) return;
            const overlay = document.getElementById('screenshotOverlay');
            const img = document.getElementById('screenshotImg');
            img.src = src;
            overlay.style.display = 'flex';
            overlay.focus();
        }
        function closeScreenshot() {
            const overlay = document.getElementById('screenshotOverlay');
            const img = document.getElementById('screenshotImg');
            overlay.style.display = 'none';
            img.src = '';
        }
        document.getElementById('screenshotClose').addEventListener('click', closeScreenshot);
        document.getElementById('screenshotOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'screenshotOverlay') closeScreenshot();
        });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeScreenshot(); });

        // Initial render
        renderClips(clips);
    </script>

</body>

</html>